<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="MobileOptimized" content="176"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="robots" content="noindex,nofollow"/>
    <link rel="stylesheet" href="style.css">
    <title>SIBA</title>
    <script>
        function setThemeClass() {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        }
        Telegram.WebApp.onEvent('themeChanged', setThemeClass);
        setThemeClass();
    </script>
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<div class="container">
    <form id="taskForm">
        <div class="form-group">
            <label for="taskName">Наименование задачи</label>
            <input type="text" class="form-control" id="taskName" placeholder="Введите название задачи">
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="important">
            <label class="form-check-label" for="important">Важно</label>
            <input class="form-check-input" type="checkbox" value="" id="repeat">
            <label class="form-check-label" for="repeat">Повторять</label>
        </div>
        <div class="form-group">
            <label for="dateTime">Дата/Время</label>
            <input type="datetime-local" class="form-control" id="dateTime">
        </div>
        <div class="form-group" style="display:none;" id="selectFrequency">
            <label for="frequency">Периодичность</label>
            <select class="form-control" id="frequency">
                <option>Ежедневно</option>
                <option>Еженедельно</option>
                <option>Ежемесячно</option>
            </select>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="target">
            <label class="form-check-label" for="target">Цель</label>
        </div>
        <div class="form-group" style="display:none;" id="targetValueGroup">
            <label for="targetValue">Количество</label>
            <input pattern="[0-9]*" type="text" class="form-control" id="targetValue" placeholder="Введите количество">
        </div>
        <div class="form-group" style="display:none;" id="valueTypeGroup">
            <label for="valueType">Тип значения</label>
            <select class="form-control" id="valueType">
                <option>раз</option>
                <option>миллилитров</option>
                <option>страниц</option>
                <option>километров</option>
                <option>штук</option>
                <option>минут</option>
                <option>часов</option>
            </select>
        </div>

    </form>
</div>
<script>
    $('#repeat').change(function() {
        if(this.checked) {
            $('#dateTime').prop('type', 'time');
            $('#selectFrequency').show();
        } else {
            $('#dateTime').prop('type', 'datetime-local');
            $('#selectFrequency').hide();
        }
    });

    $('#target').change(function() {
        if(this.checked) {
            $('#targetValueGroup').show();
            $('#valueTypeGroup').show();
        } else {
            $('#targetValueGroup').hide();
            $('#valueTypeGroup').hide();
        }
    });
    Telegram.WebApp.onEvent('mainButtonClicked', function(){
        const taskData = {
            taskName: $('#taskName').val(),
            important: $('#important').is(':checked'),
            dateTime: $('#dateTime').val(),
            repeat: $('#repeat').is(':checked'),
            frequency: $('#frequency').val(),
            target: $('#target').is(':checked'),
            targetValue: $('#targetValue').val(),
            valueType: $('#valueType').val(),
        }
        tg.sendData(JSON.stringify(taskData));
        tg.close();
    });

</script>
<script src="app.js"></script>
</body>
</html>